---
description: 実装済みコードに基づきdocs/core/、CLAUDE.md、README.mdを同期
---

# ドキュメント更新（実装済みコードとの同期）

**目的:** 実装済みコードを解析し、全ドキュメントとの整合性を維持する。

**更新対象:**
- `docs/core/` - 設計・API仕様ドキュメント
- `CLAUDE.md` - Claude Code用プロジェクトコンテキスト
- `README.md` - プロジェクト公式ドキュメント

**重要:** このコマンドは**実装完了後**に使用する。未実装の機能をドキュメントに追加してはならない。

**引数:**
- `/update-docs` - 実装済みコード全体をスキャンして同期
- `/update-docs [対象モジュール]` - 特定のモジュールに関連するドキュメントのみ更新
- `/update-docs [ファイルパス]` - 指定されたファイルパス（例: `src/core/processor.py`）に関連するドキュメントのみ更新
- `/update-docs [steeringフォルダ]` - 指定されたsteeringフォルダの実装内容に基づいて関連ドキュメントのみ更新
  - 例: `/update-docs .steering/20260207-slack-notification/`
  - 例: `/update-docs 20260207-slack-notification`（`.steering/`プレフィックス省略可）
- `/update-docs --from-report [ファイルパス]` - レビューレポートの指摘事項に沿って修正
  - 例: `/update-docs --from-report .steering/20260129-docs-review/review-report.md`

**モード判定:**
1. `--from-report` フラグが指定されている場合 → **レビュー結果修正モード**
2. 引数が `YYYYMMDD-` 形式で始まる、または `.steering/YYYYMMDD-*/` パターンに一致する場合 → **Steeringフォルダモード**
3. それ以外 → **通常モード**（従来の動作）

---

## モード別処理フロー

### レビュー結果修正モード（--from-report 指定時）

`--from-report` フラグが指定された場合、以下のステップを実行:

1. **ステップR1:** レビューレポートの読み込みと解析
2. **ステップR2:** 指摘事項の分類と優先度付け
3. **ステップR3:** 指摘事項に基づくドキュメント修正
4. **ステップR4:** 修正サマリーの出力

→ **ステップR1〜R4** を参照

### Steeringフォルダモード（steeringフォルダ指定時）

引数が `YYYYMMDD-` 形式で始まる、または `.steering/YYYYMMDD-*/` パターンに該当する場合、以下のステップを実行:

1. **ステップS1:** Steeringフォルダの検証と読み込み
2. **ステップS2:** 変更対象ファイルの特定
3. **ステップS3:** 変更対象ファイルの実装内容解析
4. **ステップS4:** 関連ドキュメントの更新
5. **ステップS5:** 更新サマリーの出力

→ **ステップS1〜S5** を参照

### 通常モード（レビューレポート以外の引数、または引数なし）

以下のステップを実行:

1. **ステップ1:** 実装済みコードの解析
2. **ステップ2:** ドキュメントの現状確認
3. **ステップ3:** 差分の検出
4. **ステップ4:** ドキュメントの更新
5. **ステップ5:** 更新サマリーの出力

→ **ステップ1〜5** を参照

---

# 通常モード

## ステップ1: 実装済みコードの解析

1. **コアモジュールのスキャン**
   ```
   Glob('src/**/*.py')
   ```
   - 各モジュールのクラス、関数、データクラスを抽出
   - 公開API（アンダースコアなしの関数/クラス）をリストアップ

2. **CLIエントリーポイントの確認**
   ```
   Read('pyproject.toml')
   → [project.scripts] セクションを解析
   ```
   - 定義されているコマンドをリストアップ

3. **設定ファイルの確認**
   ```
   Read('.env.sample')
   Read('src/config.py')
   ```
   - 設定項目をリストアップ

---

## ステップ2: ドキュメントの現状確認

1. **プロジェクトコンテキストファイル**
   ```
   Read('CLAUDE.md')
   Read('README.md')
   ```

2. **生成ドキュメント**

   コアドキュメント:
   ```
   Read('docs/core/architecture.md')
   Read('docs/core/functional-design.md')
   Read('docs/core/repository-structure.md')  # または repo-structure.md
   Read('docs/core/development-guidelines.md')  # または dev-guidelines.md
   Read('docs/core/glossary.md')
   ```

   オプションドキュメント:
   ```
   Read('docs/core/api-reference.md')
   Read('docs/core/diagrams.md')
   Read('docs/core/CHANGELOG.md')
   Read('docs/core/product-requirements.md')  # 新規プロジェクトのみ
   ```

   **注:** ファイル名は省略形（`repo-structure.md`, `dev-guidelines.md`）で存在する場合もある

3. **ドキュメントに記載されている内容を抽出**
   - コンポーネント名、クラス名、関数名、設定項目など

---

## ステップ3: 差分の検出

### 3.1 検出対象

| カテゴリ | コードから抽出 | ドキュメントから抽出 |
|----------|---------------|-------------------|
| Models | モジュール定義 (src/models/) | architecture.md, api-reference.md |
| Utils | ユーティリティ (src/utils/) | architecture.md, api-reference.md |
| Preprocess | 前処理 (src/preprocess/) | architecture.md, api-reference.md |
| Postprocess | 後処理 (src/postprocess/) | architecture.md, api-reference.md |
| Config | 設定 (src/config.py) | architecture.md, api-reference.md |
| CLI | pyproject.toml, src/run_*.py | repository-structure.md, README.md |
| 設定項目 | .env, src/config.py | api-reference.md, README.md |

### 3.2 差分種別

| 差分種別 | 説明 | 対応 |
|----------|------|------|
| **追加** | コードにあるがドキュメントにない | ドキュメントに追加 |
| **削除** | ドキュメントにあるがコードにない | ドキュメントから削除 |
| **変更** | シグネチャ・説明の不一致 | ドキュメントを更新 |

---

## ステップ4: ドキュメントの更新

### 4.1 architecture.md の更新

**対象:**
- 新規/削除されたコンポーネント
- データフローの変更
- 外部サービス連携の変更

**更新方法:**
```
Edit('docs/core/architecture.md')
→ コンポーネント図、データフロー図を更新
```

### 4.2 repository-structure.md の更新

**対象:**
- 新規/削除されたファイル
- ディレクトリ構造の変更
- CLI コマンドの変更

**更新方法:**
```
Edit('docs/core/repository-structure.md')
→ ディレクトリツリー、モジュール説明を更新
```

### 4.3 api-reference.md の更新

**対象:**
- 新規/削除されたクラス・関数
- メソッドシグネチャの変更
- データクラスの変更

**更新方法:**
```
Edit('docs/core/api-reference.md')
→ API仕様を更新
```

### 4.4 diagrams.md の更新

**対象:**
- シーケンス図の変更
- クラス関係図の変更
- 状態遷移図の変更

**更新方法:**
```
Edit('docs/core/diagrams.md')
→ Mermaid図を更新
```

### 4.5 development-guidelines.md の更新

**対象:**
- 開発手順の変更
- コーディング規約の変更
- 新しいパターンの追加

**更新方法:**
```
Edit('docs/core/development-guidelines.md')
→ 該当セクションを更新
```

### 4.6 functional-design.md の更新

**対象:**
- 機能仕様の変更
- 画面フロー・状態遷移の変更
- ユースケースの追加・変更

**更新方法:**
```
Edit('docs/core/functional-design.md')
→ 機能仕様、画面フロー、ユースケースを更新
```

### 4.7 glossary.md の更新

**対象:**
- 新規用語の追加
- 用語定義の変更
- 廃止用語の削除

**更新方法:**
```
Edit('docs/core/glossary.md')
→ 用語集を更新
```

### 4.8 product-requirements.md の更新（新規プロジェクトのみ）

**対象:**
- 実装完了した機能要件のステータス更新
- 新規実装された機能の反映
- 削除された機能の反映

**更新方法:**
```
Edit('docs/core/product-requirements.md')
→ 機能要件のステータス、実装済み機能を更新
```

### 4.9 CLAUDE.md の更新

**対象:**
- 実装済みコンポーネント一覧
- ディレクトリ構成
- よく使うコマンド
- コーディングパターン
- 技術スタック
- 次の実装予定

**更新内容:**
- `src/models/` の実装からモデル一覧を更新
- `src/utils/` の実装からユーティリティ一覧を更新
- `src/run_*.py` の実装からCLIコマンド一覧を更新
- 新しいコーディングパターンがあれば追加
- 「次の実装予定」を現状に合わせて更新

**チェックポイント:**
- [ ] 「実装済みコンポーネント」が実際のコードと一致している
- [ ] 「ディレクトリ構成」が実際の構造と一致している
- [ ] 「よく使うコマンド」が動作する
- [ ] 「次の実装予定」が計画と整合している

### 4.10 README.md の更新

**対象:**
- 使用方法セクション（CLIコマンド）
- プロジェクト構成セクション（ディレクトリツリー）
- 出力形式セクション（出力ディレクトリ構造）
- 設定クラス構造テーブル
- 環境変数一覧

**更新内容:**
- 新規CLIコマンドの使用例を追加
- ディレクトリツリーに新規モジュールを追加
- 出力ディレクトリ構造に新規出力を追加
- 設定クラステーブルに新規設定を追加
- 環境変数一覧に新規変数を追加

**チェックポイント:**
- [ ] 「使用方法」が実際のCLIコマンドと一致している
- [ ] 「プロジェクト構成」が実際のディレクトリ構造と一致している
- [ ] 「出力形式」が実際の出力と一致している
- [ ] 「設定クラス構造」が src/config.py と一致している

---

## ステップ5: 更新サマリーの出力

更新完了後、以下の形式でサマリーを出力:

```
## ドキュメント同期完了

### 検出された差分

| ドキュメント | 追加 | 削除 | 変更 |
|-------------|------|------|------|
| CLAUDE.md | 1 | 0 | 2 |
| README.md | 1 | 0 | 2 |
| architecture.md | 0 | 0 | 0 |
| functional-design.md | 0 | 0 | 0 |
| repository-structure.md | 1 | 0 | 0 |
| development-guidelines.md | 0 | 0 | 0 |
| glossary.md | 0 | 0 | 0 |
| api-reference.md | 2 | 1 | 0 |
| diagrams.md | 0 | 0 | 1 |
| product-requirements.md | 0 | 0 | 0 |
| CHANGELOG.md | 1 | 0 | 0 |

### 更新内容

#### CLAUDE.md
- 追加: 新サービスを実装済みコンポーネントに追加
- 変更: ディレクトリ構成を更新
- 変更: 次の実装予定を更新

#### docs/core/repository-structure.md
- 追加: src/services/xxx_service.py

#### docs/core/api-reference.md
- 追加: 新規クラス/関数
- 削除: 廃止されたコンポーネント

#### docs/core/CHANGELOG.md
- 追加: 新機能を実装済みに更新

### 次のステップ
1. `/review-docs` を実行してドキュメント品質をレビュー
2. 指摘された問題があれば修正
3. 問題がなければコミット
```

---

## 注意事項

### 絶対守るべきルール

1. **未実装機能を記載しない**
   - `docs/ideas/`の内容を`docs/core/`に転記しない
   - 実装済みコードのみをドキュメント化

2. **削除は慎重に**
   - コードから削除されたものはドキュメントからも削除
   - ただし、手動で追加された説明文は保持

3. **整合性優先**
   - コードが正（source of truth）
   - ドキュメントはコードの反映

### 更新時の注意

- `CLAUDE.md`:
  - 実装済みコンポーネント、ディレクトリ構成、コマンドを自動更新
  - コーディングパターンの説明文は手動管理
  - 「次の実装予定」は計画に合わせて更新

- `README.md`:
  - 使用方法、プロジェクト構成、出力形式を自動更新
  - 概要、セットアップ手順は手動管理
  - Docker関連セクションは手動管理

- `docs/core/`: 全体を自動更新

- `docs/ideas/`: アイデアファイルは別管理（更新対象外）

### エラー処理

- ドキュメントが存在しない場合: `/gen-docs`の実行を提案
- コードの解析に失敗した場合: エラーメッセージを出力して終了
- 差分が大きすぎる場合: 確認を促す

---

## ワークフロー全体での位置づけ

```
/plan-feature
    ↓ （計画作成）
/implement-feature
    ↓ （実装完了）
/update-docs {steeringフォルダ} ← ここ（Steeringフォルダモード: 実装範囲に限定した効率的な同期）
    ↓
/validate-code
    ↓ （コード修正が発生する可能性）
/update-docs ← ここ（通常モード: 実装・修正後の全体同期）
    ↓
/review-docs
    ↓ （品質レビュー）
/update-docs --from-report {レビューレポート} ← ここ（レビュー結果修正モード）
    ↓ （指摘事項の修正）
コード完成
```

このコマンドは3つの用途がある:

1. **通常モード**: 実装フェーズの最後に実行し、コードとドキュメントの整合性を確保
2. **Steeringフォルダモード**: 特定機能の実装後に実行し、その機能に関連するドキュメントだけを効率的に更新
3. **レビュー結果修正モード**: `/review-docs` の指摘事項に沿って修正を実行

推奨ワークフロー:
1. `/update-docs .steering/YYYYMMDD-feature-name/` で実装した機能のドキュメントを同期（Steeringフォルダモード）
2. `/review-docs` でドキュメント品質をレビュー
3. `/update-docs --from-report .steering/YYYYMMDD-docs-review/review-report.md` でレビュー指摘を修正
4. 必要に応じて2-3を繰り返す
5. 全体的な整合性確認が必要な場合は `/update-docs`（通常モード）を実行

---

# Steeringフォルダモード

steeringフォルダ（`.steering/YYYYMMDD-機能名/`）を引数として指定した場合のフロー。
フォルダ内の`requirements.md`、`design.md`、`tasklist.md`から実装内容を把握し、その機能に関連するドキュメントのみを効率的に更新する。

## ステップS1: Steeringフォルダの検証と読み込み

### S1.1 フォルダパスの解決

```
# 引数が YYYYMMDD- 形式で始まる場合 → .steering/ プレフィックスを付与
# 引数が .steering/YYYYMMDD-*/ 形式の場合 → そのまま使用

# 例:
# "20260207-slack-notification" → ".steering/20260207-slack-notification/"
# ".steering/20260207-slack-notification/" → ".steering/20260207-slack-notification/"
```

### S1.2 フォルダの存在確認

```
Glob('.steering/{フォルダ名}/')

# フォルダが存在しない場合:
エラー: `.steering/{指定されたフォルダ名}/` が見つかりません。
→ 正しいフォルダ名を指定してください。
→ `.steering/` 内の既存フォルダ一覧を表示
```

### S1.3 計画ドキュメントの読み込み

```
Read('.steering/{フォルダ名}/requirements.md')
Read('.steering/{フォルダ名}/design.md')
Read('.steering/{フォルダ名}/tasklist.md')
```

- 3ファイルすべてが存在する必要がある
- 存在しないファイルがある場合: 警告を出力し、存在するファイルのみで処理を続行
- 読み込んだ内容から、実装された機能のコンテキストを把握

---

## ステップS2: 変更対象ファイルの特定

`design.md`と`tasklist.md`から以下を抽出:

### S2.1 ファイルリストの抽出

| 抽出対象 | 抽出元 | 例 |
|----------|--------|-----|
| 新規作成されたソースファイル | design.md（ファイル構成）、tasklist.md（完了タスク） | `src/utils/helper.py` |
| 変更されたソースファイル | design.md（変更箇所）、tasklist.md（完了タスク） | `src/core/processor.py` |
| 新規作成されたテストファイル | design.md、tasklist.md | `tests/test_helper.py` |
| 変更された設定ファイル | design.md（設定変更）、tasklist.md | `.env.example`, `config.py` |

### S2.2 ファイル存在確認

```
# 抽出した各ファイルが実際に存在するか確認
for ファイル in 抽出ファイルリスト:
    Glob('{ファイル}')
    # 存在しない場合はリストから除外し警告
```

---

## ステップS3: 変更対象ファイルの実装内容解析

特定したファイルを実際に読み込み、ドキュメント更新に必要な情報を抽出:

### S3.1 ソースファイルの解析

```
for ファイル in ソースファイルリスト:
    Read('{ファイル}')
    → クラス、関数、データクラスの抽出
    → 公開API（アンダースコアなしの関数/クラス）のリストアップ
    → docstringからの説明文抽出
```

### S3.2 設定ファイルの変更確認

```
for ファイル in 設定ファイルリスト:
    Read('{ファイル}')
    → 新規追加された設定項目の特定
    → 環境変数の変更確認
```

### S3.3 実装内容の要約

steeringフォルダの計画ドキュメントと実際のコードから、以下を整理:
- 新規追加されたコンポーネントの概要
- 変更されたデータフロー
- 新規API/クラス/関数の一覧
- 新規設定項目の一覧

---

## ステップS4: 関連ドキュメントの更新

通常モードのステップ2〜4と同様の更新ロジックだが、**スコープをsteeringフォルダの実装範囲に限定**。

### S4.1 ドキュメントの現状確認と更新判定

各ドキュメントについて、steeringフォルダの実装内容に関連する更新が必要か判定:

| ドキュメント | 更新条件 |
|-------------|----------|
| `docs/core/architecture.md` | 新コンポーネント追加、データフロー変更がある場合 |
| `docs/core/repository-structure.md` | 新ファイル/ディレクトリ追加がある場合 |
| `docs/core/api-reference.md` | 新クラス/関数/公開APIがある場合 |
| `docs/core/diagrams.md` | データフロー変更、コンポーネント関係変更がある場合 |
| `docs/core/functional-design.md` | 機能仕様の追加・変更がある場合 |
| `docs/core/development-guidelines.md` | 開発手順・パターンの変更がある場合 |
| `docs/core/glossary.md` | 新規用語が導入された場合 |
| `docs/core/CHANGELOG.md` | 常に更新（機能追加を記録） |
| `CLAUDE.md` | 該当モジュール情報の追加・更新がある場合 |
| `README.md` | 該当セクションの追加・更新がある場合 |

### S4.2 ドキュメントの更新実行

更新が必要と判定されたドキュメントのみを対象に、通常モードのステップ4と同じ手順で更新:

```
for ドキュメント in 更新対象ドキュメント:
    Read('{ドキュメント}')
    # steeringフォルダの実装内容に関連する部分のみ更新
    Edit('{ドキュメント}')
```

**注意:**
- 更新はsteeringフォルダの実装範囲に関係する箇所のみ
- 実装範囲外の既存ドキュメントの問題は修正しない（通常モードで対応）
- CHANGELOG.mdには`requirements.md`の機能名と概要を使用

---

## ステップS5: 更新サマリーの出力

更新完了後、以下の形式でサマリーを出力:

```
## ドキュメント同期完了（Steeringフォルダモード）

### 参照したSteeringフォルダ
- パス: .steering/{フォルダ名}/
- 機能名: {requirements.mdから取得した機能名}

### 検出された変更ファイル
- 新規ソースファイル: {N}件
- 変更ソースファイル: {N}件
- 新規テストファイル: {N}件
- 変更設定ファイル: {N}件

### 更新されたドキュメント

| ドキュメント | 追加 | 削除 | 変更 |
|-------------|------|------|------|
| CLAUDE.md | 1 | 0 | 0 |
| README.md | 1 | 0 | 0 |
| repository-structure.md | 2 | 0 | 0 |
| api-reference.md | 1 | 0 | 0 |
| CHANGELOG.md | 1 | 0 | 0 |

### 更新内容

#### CLAUDE.md
- 追加: {コンポーネント名}セクションを追加

#### docs/core/CHANGELOG.md
- 追加: {機能名}を記録

...

### スキップしたドキュメント（更新不要）
- architecture.md: 既存アーキテクチャへの変更なし
- diagrams.md: データフロー変更なし

### 次のステップ
1. `/review-docs` を実行してドキュメント品質をレビュー
2. 指摘された問題があれば修正
3. 問題がなければコミット
```

---

# レビュー結果修正モード

レビューレポートファイル（`.steering/**/review-report.md`）を引数として指定した場合のフロー。

## ステップR1: レビューレポートの読み込みと解析

### R1.1 レポートファイルの検証

```
# 特定されたファイルが存在するか確認
Read('{レビューレポートパス}')

# 有効なレビューレポートかを確認
→ "# ドキュメントレビューレポート" ヘッダーの存在を確認
→ サマリーテーブルの存在を確認
```

### R1.2 指摘事項の抽出

レビューレポートから以下のセクションを解析:

| セクション | 抽出内容 |
|-----------|----------|
| **1. 完全性** | 未記載モジュール、未記載API |
| **2. 最新性** | 更新が必要なドキュメント、未反映コード変更 |
| **3. 正確性** | コードとの乖離、存在しないパス |
| **4. 分かりやすさ** | 説明不足、曖昧な記述 |
| **5. 一貫性** | 命名の不統一、フォーマットの不統一 |
| **6. 改善提案** | 優先度別の改善項目 |

### R1.3 指摘事項のパース

```
# テーブル形式の指摘を抽出
正規表現パターン:
- コードとの乖離: | メソッド名 | `old_name()` | `new_name()` | api-reference.md |
- 存在しないパス: | `src/old_module.py` | repository-structure.md | 削除または更新 |
- 未記載モジュール: | `src/xxx/yyy.py` | repository-structure.mdに追加 |
- 曖昧な記述: | "適切に処理する" | xxx.md:20 | 具体的な処理内容を記載 |

# チェックリスト形式の改善提案を抽出
- [ ] {問題}: {対応方法}
```

---

## ステップR2: 指摘事項の分類と優先度付け

### R2.1 指摘事項の分類

| カテゴリ | 修正タイプ | 自動修正可否 |
|---------|-----------|-------------|
| 存在しないパス | 削除 | 自動可 |
| コードとの乖離（名前変更） | 置換 | 自動可 |
| 未記載モジュール | 追加 | 自動可 |
| 未記載API | 追加 | 自動可 |
| 曖昧な記述 | 書き換え | コード参照して修正 |
| 説明不足 | 追加 | コード参照して修正 |
| フォーマット不統一 | 修正 | 自動可 |
| 命名不統一 | 置換 | 自動可 |

### R2.2 優先度の決定

レビューレポートの改善提案セクションに記載された優先度に従う:

1. **優先度: 高** → 最優先で修正
2. **優先度: 中** → 次に修正
3. **優先度: 低** → 最後に修正

---

## ステップR3: 指摘事項に基づくドキュメント修正

### R3.1 正確性の問題を修正

#### 存在しないパスの削除

```
# レビューレポートから存在しないパスを取得
存在しないパス = "3. 正確性" → "存在しないパス" テーブルから抽出

# 各パスについて
for パス, ファイル in 存在しないパス:
    Read('docs/core/{ファイル}')
    # 該当パスを含む行を削除または更新
    Edit('docs/core/{ファイル}')
```

#### コードとの乖離の修正

```
# レビューレポートから乖離情報を取得
乖離一覧 = "3. 正確性" → "コードとの乖離" テーブルから抽出

# 各乖離について
for 項目, ドキュメント記載, 実際, ファイル in 乖離一覧:
    Read('docs/core/{ファイル}')
    # ドキュメント記載を実際の値に置換
    Edit('docs/core/{ファイル}', ドキュメント記載, 実際)
```

### R3.2 完全性の問題を修正

#### 未記載モジュールの追加

```
# レビューレポートから未記載モジュールを取得
未記載モジュール = "1. 完全性" → "未記載モジュール" テーブルから抽出

# 各モジュールについて
for モジュール, 対応 in 未記載モジュール:
    # 実際のコードを読んで内容を把握
    Read('{モジュールパス}')

    # 対象ドキュメントに追加
    Read('docs/core/repository-structure.md')
    Edit('docs/core/repository-structure.md')  # 適切な場所に追加
```

#### 未記載APIの追加

```
# レビューレポートから未記載APIを取得
未記載API = "1. 完全性" → "未記載API" テーブルから抽出

# 各APIについて
for クラス/関数, ファイル, 対応 in 未記載API:
    # 実際のコードを読んでシグネチャ・docstringを取得
    Read('src/{ファイル}')
    Grep('{クラス/関数}', 'src/{ファイル}')

    # api-reference.mdに追加
    Read('docs/core/api-reference.md')
    Edit('docs/core/api-reference.md')  # 適切な形式で追加
```

### R3.3 分かりやすさの問題を修正

#### 説明不足の補完

```
# レビューレポートから説明不足箇所を取得
説明不足 = "4. 分かりやすさ" → "説明不足" テーブルから抽出

# 各箇所について
for 項目, ファイル, 推奨対応 in 説明不足:
    # 該当コードを読んで理解
    Grep('{項目}', 'src/')
    Read('{該当ソースファイル}')

    # ドキュメントを更新
    Read('docs/core/{ファイル}')
    Edit('docs/core/{ファイル}')  # 説明を追加
```

#### 曖昧な記述の具体化

```
# レビューレポートから曖昧な記述を取得
曖昧記述 = "4. 分かりやすさ" → "曖昧な記述" テーブルから抽出

# 各記述について
for 記述, ファイル位置, 推奨修正 in 曖昧記述:
    # ファイルと行番号をパース（例: xxx.md:20）
    ファイル, 行番号 = ファイル位置.split(':')

    # 該当ドキュメントを読む
    Read('docs/core/{ファイル}')

    # 関連コードを読んで具体的な内容を把握
    # 曖昧な表現を具体的な記述に置換
    Edit('docs/core/{ファイル}')
```

### R3.4 一貫性の問題を修正

#### 命名の統一

```
# レビューレポートから命名の不統一を取得
命名不統一 = "5. 一貫性" → "命名の不統一" テーブルから抽出

# 各項目について
for 項目, 出現パターン, 推奨 in 命名不統一:
    # 全ドキュメントで推奨に統一
    Glob('docs/core/*.md')
    for ドキュメント in ドキュメント一覧:
        Read(ドキュメント)
        # 不統一な表現を推奨に置換
        Edit(ドキュメント, 不統一表現, 推奨)
```

#### フォーマットの統一

```
# レビューレポートからフォーマットの不統一を取得
フォーマット不統一 = "5. 一貫性" → "フォーマットの不統一" テーブルから抽出

# 各問題について
for 問題, 場所, 推奨対応 in フォーマット不統一:
    # ファイルと行番号をパース
    ファイル, 行番号 = 場所.split(':')

    Read('docs/core/{ファイル}')
    # 推奨対応に従って修正
    Edit('docs/core/{ファイル}')
```

### R3.5 改善提案の対応

```
# 優先度順に改善提案を処理
for 優先度 in ['高', '中', '低']:
    改善項目 = "6. 改善提案" → "優先度: {優先度}" から抽出

    for 問題, 対応方法 in 改善項目:
        # 対応方法に従って修正を実行
        # 必要に応じてコードを参照
```

---

## ステップR4: 修正サマリーの出力

修正完了後、以下の形式でサマリーを出力:

```
## レビュー結果に基づくドキュメント修正完了

### 参照したレビューレポート
- パス: {レビューレポートパス}
- 生成日時: {レポートの生成日時}

### 修正サマリー

| カテゴリ | 修正件数 | 修正内容 |
|---------|----------|----------|
| 正確性 | {N}件 | 存在しないパス削除、名前変更反映 |
| 完全性 | {N}件 | 未記載モジュール/API追加 |
| 分かりやすさ | {N}件 | 説明追加、曖昧表現の具体化 |
| 一貫性 | {N}件 | 命名統一、フォーマット統一 |
| **合計** | **{N}件** | |

### 修正詳細

#### 正確性
- ✅ `src/old_module.py` を repository-structure.md から削除
- ✅ `old_name()` → `new_name()` に修正 (api-reference.md)

#### 完全性
- ✅ `src/xxx/yyy.py` を repository-structure.md に追加
- ✅ `XxxClass` を api-reference.md に追加

#### 分かりやすさ
- ✅ `XxxClass` に概要説明を追加 (api-reference.md)
- ✅ "適切に処理する" を具体的な記述に修正 (xxx.md:20)

#### 一貫性
- ✅ "コレクター" → "Collector" に統一
- ✅ コードブロックに言語指定を追加 (architecture.md:45)

### 未対応項目

以下の項目は手動対応が必要です:

| 項目 | 理由 | 推奨対応 |
|------|------|----------|
| {項目} | {理由} | {推奨対応} |

### 次のステップ
1. 修正内容を確認
2. 未対応項目を手動で修正
3. `/review-docs` を再実行して品質を確認
4. 問題がなければコミット
```

---

## レビュー結果修正モードの注意事項

### 修正方針

1. **レビューレポートの指摘を忠実に反映**
   - レポートに記載された推奨対応に従う
   - 勝手な判断で追加修正しない

2. **コードを参照して正確に修正**
   - 曖昧な記述の具体化はコードを読んで判断
   - 未記載APIの追加は実際のシグネチャを使用

3. **修正できない項目は明示**
   - 自動修正できない項目は未対応として報告
   - 理由と推奨対応を明記

### エラー処理

- レビューレポートが存在しない場合: エラーメッセージを出力して終了
- レビューレポートの形式が不正な場合: パースできる部分のみ処理
- 修正対象ドキュメントが存在しない場合: スキップして報告

---

## Steeringフォルダモードの注意事項

### 適用方針

1. **スコープを限定する**
   - steeringフォルダの計画ドキュメントに記載された範囲のみ更新
   - 実装範囲外の既存ドキュメントの問題は修正しない

2. **計画ドキュメントとコードの両方を参照**
   - `requirements.md`から機能の目的と概要を把握
   - `design.md`から変更ファイルと設計を把握
   - `tasklist.md`から完了状況を把握
   - 実際のソースコードを読んで正確な情報を取得

3. **通常モードとの使い分け**
   - 特定機能の実装直後 → Steeringフォルダモード（効率的）
   - 複数機能の実装後や全体整合性確認 → 通常モード（網羅的）

### エラー処理

- steeringフォルダが存在しない場合: エラーメッセージと`.steering/`内の既存フォルダ一覧を出力して終了
- 計画ドキュメント（requirements.md等）が不足している場合: 警告を出力し、存在するファイルのみで処理を続行
- 変更対象ファイルが実際に存在しない場合: スキップして警告を出力
